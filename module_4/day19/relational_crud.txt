-- 1) CREATE TABLES
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name TEXT,
    email TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    amount INTEGER,
    status TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

Output:
CREATE TABLE
CREATE TABLE


-- 2) INSERT USERS
INSERT INTO users (name, email) VALUES
('Asha', 'asha@gmail.com'),
('Ravi', 'ravi@gmail.com'),
('Neha', 'neha@gmail.com'),
('Kiran', 'kiran@gmail.com'),
('Meena', 'meena@gmail.com');

Output:
INSERT 0 5


-- 3) INSERT ORDERS
INSERT INTO orders (user_id, amount, status) VALUES
(1, 500, 'pending'),
(1, 700, 'completed'),
(2, 300, 'completed'),
(3, 450, 'pending'),
(3, 800, 'completed'),
(3, 200, 'cancelled'),
(4, 1000, 'completed'),
(5, 650, 'pending'),
(2, 900, 'completed'),
(1, 250, 'completed');

Output:
INSERT 0 10


-- 4) FETCH ALL USERS
SELECT * FROM users;

Output:
id | name  | email
1  | Asha  | asha@gmail.com
2  | Ravi  | ravi@gmail.com
3  | Neha  | neha@gmail.com
4  | Kiran | kiran@gmail.com
5  | Meena | meena@gmail.com


-- 5) FETCH ALL ORDERS
SELECT * FROM orders;

Output:
10 rows with user_id, amount, status


-- 6) ORDERS OF USER 1
SELECT * FROM orders WHERE user_id = 1;

Output:
3 rows


-- 7) USERS WITH MORE THAN ONE ORDER
SELECT u.id, u.name, COUNT(o.id) AS total_orders
FROM users u
JOIN orders o ON u.id = o.user_id
GROUP BY u.id, u.name
HAVING COUNT(o.id) > 1;

Output:
id | name | total_orders
1  | Asha | 3
2  | Ravi | 2
3  | Neha | 3


-- 8) TOTAL ORDER AMOUNT PER USER
SELECT u.name, SUM(o.amount) AS total_amount
FROM users u
JOIN orders o ON u.id = o.user_id
GROUP BY u.name;

Output:
name  | total_amount
Asha  | 1450
Ravi  | 1200
Neha  | 1450
Kiran | 1000
Meena | 650


-- 9) UPDATE EMAIL
UPDATE users
SET email = 'asha_new@gmail.com'
WHERE id = 1;

Output:
UPDATE 1


-- 10) UPDATE STATUS FOR USER 3
UPDATE orders
SET status = 'completed'
WHERE user_id = 3;

Output:
UPDATE 3


-- 11) UPDATE AMOUNT OF ORDER 2
UPDATE orders
SET amount = 750
WHERE id = 2;

Output:
UPDATE 1


-- 12) DELETE ONE ORDER
DELETE FROM orders WHERE id = 5;

Output:
DELETE 1


-- 13) DELETE ORDERS OF USER 2
DELETE FROM orders WHERE user_id = 2;

Output:
DELETE 2


-- 14) TRY DELETE USER WITH ORDERS
DELETE FROM users WHERE id = 1;

Output:
ERROR: update or delete on table "users" violates foreign key constraint


-- 15) CONCEPT ANSWER
-- Orders should not be stored inside users table because
-- one user can have multiple orders (one-to-many).
-- This causes data duplication and breaks normalization.
-- Using separate tables with foreign keys maintains proper design.